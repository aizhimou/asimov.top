<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>Clickhouse - Tag - Asimov's Blog</title><link>https://asimov.top/tags/clickhouse/</link><description>Clickhouse - Tag - Asimov's Blog</description><generator>Hugo -- gohugo.io</generator><managingEditor>1224513626@qq.com (asimov)</managingEditor><webMaster>1224513626@qq.com (asimov)</webMaster><lastBuildDate>Tue, 16 Mar 2021 21:35:39 +0800</lastBuildDate><atom:link href="https://asimov.top/tags/clickhouse/" rel="self" type="application/rss+xml"/><item><title>Clickhouse 亿级数据性能测试</title><link>https://asimov.top/clickhouse-billion-level-data-performance-test/</link><pubDate>Tue, 16 Mar 2021 21:35:39 +0800</pubDate><author>asimov</author><guid>https://asimov.top/clickhouse-billion-level-data-performance-test/</guid><description><![CDATA[<div class="featured-image">
                <img src="https://img.lifelog.cool/Using%20ClickHouse%20with%20MetricFire_waifu2x_art_noise3_scale.webp" referrerpolicy="no-referrer">
            </div><p>Clickhouse 在离线数据分析技术领域早已声名远扬，如果还不知道可以 <a href="https://clickhouse.tech/docs/zh/" target="_blank" rel="noopener noreffer ">点这里</a> 了解下。</p>
<p>最近由于项目需求使用到了 clickhouse 做分析数据库，于是用测试环境做了一个单表 6 亿数据量的性能测试，记录一下测试结果，有做超大数据量分析技术选型需求的朋友可以参考下。</p>
<h2 id="服务器信息">服务器信息</h2>
<ul>
<li>CPU：Intel Xeon Gold 6240 @ 8x 2.594GHz</li>
<li>内存：32G</li>
<li>系统：CentOS 7.6</li>
<li>Linux内核版本：3.10.0</li>
<li>磁盘类型：机械硬盘</li>
<li>文件系统：ext4</li>
</ul>
<h2 id="clickhouse-信息">Clickhouse 信息</h2>
<ul>
<li>部署方式：单机部署</li>
<li>版本：20.8.11.17</li>
</ul>
<h2 id="测试情况">测试情况</h2>
<blockquote>
<p>测试数据和测试方法来自 clickshouse 官方的 <a href="https://clickhouse.tech/docs/en/getting-started/example-datasets/star-schema/" target="_blank" rel="noopener noreffer ">Star Schema Benchmark</a></p>
</blockquote>
<p>按照官方指导造出了测试数据之后，先看一下数据量和空间占用情况。</p>
<h3 id="数据量和空间占用">数据量和空间占用</h3>
<table>
<thead>
<tr>
<th>表名</th>
<th>列数</th>
<th>数据行数</th>
<th>原始大小</th>
<th>压缩大小</th>
<th>压缩率</th>
</tr>
</thead>
<tbody>
<tr>
<td>supplier</td>
<td>6</td>
<td>200,000</td>
<td>11.07 MiB</td>
<td>7.53 MiB</td>
<td>68</td>
</tr>
<tr>
<td>customer</td>
<td>7</td>
<td>3,000,000</td>
<td>168.83 MiB</td>
<td>114.72 MiB</td>
<td>68</td>
</tr>
<tr>
<td>part</td>
<td>8</td>
<td>1,400,000</td>
<td>34.29 MiB</td>
<td>24.08 MiB</td>
<td>70</td>
</tr>
<tr>
<td>lineorder</td>
<td>16</td>
<td>600,037,902</td>
<td>24.03 GiB</td>
<td>16.67 GiB</td>
<td>69</td>
</tr>
<tr>
<td>lineorder_flat</td>
<td>37</td>
<td>688,552,212</td>
<td>111.38 GiB</td>
<td>61.05 GiB</td>
<td>55</td>
</tr>
</tbody>
</table>
<p>可以看到 clickhouse 的压缩率很高，压缩率都在 50 以上，基本可以达到 70 左右。<strong>数据体积的减小可以非常有效的减少磁盘空间占用、提高 I/O 性能，这对整体查询性能的提升非常有效。</strong></p>
<p>supplier、customer、part、lineorder 为一个简单的「供应商-客户-订单-地区」的星型模型，lineorder_flat 为根据这个星型模型数据关系合并的大宽表，所有分析都直接在这张大宽表中执行，减少不必要的表关联，符合我们实际工作中的分析建表逻辑。</p>
<p>以下性能测试的所有分析 SQL 都在这张大宽表中运行，未进行表关联查询。</p>
<h3 id="查询性能测试详情">查询性能测试详情</h3>
<h4 id="query-11">Query 1.1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_EXTENDEDPRICE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">LO_DISCOUNT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1993</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">LO_DISCOUNT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">LO_DISCOUNT</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">LO_QUANTITY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">25</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌────────</span><span class="n">revenue</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">44652567249651</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└────────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">242</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">91</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">728</span><span class="p">.</span><span class="mi">06</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="p">(</span><span class="mi">375</span><span class="p">.</span><span class="mi">91</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">01</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：91,010,000</strong> <em>大约9100万</em></p>
<p><strong>耗时(秒)：0.242</strong></p>
<p><strong>查询列数：2</strong></p>
<p><strong>结果行数：1</strong></p>
<h4 id="query-12">Query 1.2</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_EXTENDEDPRICE</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">LO_DISCOUNT</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">toYYYYMM</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">199401</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">LO_DISCOUNT</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">LO_DISCOUNT</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">6</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">LO_QUANTITY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">26</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">LO_QUANTITY</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">35</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌───────</span><span class="n">revenue</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">9624332170119</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└───────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">1</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">040</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">7</span><span class="p">.</span><span class="mi">75</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">61</span><span class="p">.</span><span class="mi">96</span><span class="w"> </span><span class="n">MB</span><span class="w"> </span><span class="p">(</span><span class="mi">191</span><span class="p">.</span><span class="mi">44</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">53</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：7,750,000</strong> <em>775万</em></p>
<p><strong>耗时(秒)：0.040</strong></p>
<p><strong>查询列数：2</strong></p>
<p><strong>返回行数：1</strong></p>
<h4 id="query-21">Query 2.1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">P_CATEGORY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MFGR#12&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">)</span><span class="err">─┬─</span><span class="k">year</span><span class="err">─┬─</span><span class="n">P_BRAND</span><span class="err">───┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">64420005618</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">121</span><span class="w">  </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">63389346096</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">1210</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="p">...........</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">..........</span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">39679892915</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">128</span><span class="w">  </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">35300513083</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">129</span><span class="w">  </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└─────────────────┴──────┴───────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">280</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">558</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">600</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">.</span><span class="mi">20</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">70</span><span class="p">.</span><span class="mi">11</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">725</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：8.558</strong></p>
<p><strong>查询列数：3</strong></p>
<p><strong>结果行数：280</strong></p>
<h4 id="query-22">Query 2.2</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">((</span><span class="n">P_BRAND</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="s1">&#39;MFGR#2221&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">P_BRAND</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="s1">&#39;MFGR#2228&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ASIA&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_BRAND</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">)</span><span class="err">─┬─</span><span class="k">year</span><span class="err">─┬─</span><span class="n">P_BRAND</span><span class="err">───┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">66450349438</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">2221</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">65423264312</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">2222</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="p">...........</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">.........</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">39907545239</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">2227</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w">     </span><span class="mi">40654201840</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">2228</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└─────────────────┴──────┴───────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">56</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">242</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">600</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">60</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">482</span><span class="p">.</span><span class="mi">97</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="mi">51</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：1.242</strong></p>
<p><strong>查询列数：3</strong></p>
<p><strong>结果行数：56</strong></p>
<h4 id="query-31">Query 3.1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">C_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ASIA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ASIA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1992</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1997</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">revenue</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="n">C_NATION</span><span class="err">──┬─</span><span class="n">S_NATION</span><span class="err">──┬─</span><span class="k">year</span><span class="err">─┬──────</span><span class="n">revenue</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">INDIA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">INDIA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">537778456208</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">INDONESIA</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">INDIA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">536684093041</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="p">.....</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="p">.......</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">............</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">CHINA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">CHINA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">525562838002</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">JAPAN</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">VIETNAM</span><span class="w">   </span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">525495763677</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└───────────┴───────────┴──────┴──────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">150</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">.</span><span class="mi">533</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">546</span><span class="p">.</span><span class="mi">67</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">48</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">154</span><span class="p">.</span><span class="mi">72</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">55</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w"> 
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：546,670,000</strong> <em>大约5亿4千多万</em></p>
<p><strong>耗时(秒)：3.533</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：150</strong></p>
<h4 id="query-32">Query 3.2</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_CITY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_CITY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">revenue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">C_NATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UNITED STATES&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_NATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UNITED STATES&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">1992</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1997</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_CITY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_CITY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">revenue</span><span class="w"> </span><span class="k">DESC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="n">C_CITY</span><span class="err">─────┬─</span><span class="n">S_CITY</span><span class="err">─────┬─</span><span class="k">year</span><span class="err">─┬────</span><span class="n">revenue</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST6</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST6</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">5694246807</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST0</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST0</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">5676049026</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="p">..........</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">..........</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">..........</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST9</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST9</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">4836163349</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST9</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">ST5</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="mi">4769919410</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└────────────┴────────────┴──────┴────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">600</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">000</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">546</span><span class="p">.</span><span class="mi">67</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">56</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">546</span><span class="p">.</span><span class="mi">59</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">56</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：546,670,000</strong> <em>大约5亿4千多万</em></p>
<p><strong>耗时(秒)：1.00</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：600</strong></p>
<h4 id="query-41">Query 4.1</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LO_SUPPLYCOST</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">C_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">P_MFGR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MFGR#1&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">P_MFGR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MFGR#2&#39;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_NATION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">C_NATION</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="k">year</span><span class="err">─┬─</span><span class="n">C_NATION</span><span class="err">──────┬────────</span><span class="n">profit</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">ARGENTINA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="mi">1041983042066</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1992</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">BRAZIL</span><span class="w">        </span><span class="err">│</span><span class="w"> </span><span class="mi">1031193572794</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">......</span><span class="w">        </span><span class="err">│</span><span class="w">  </span><span class="p">............</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">PERU</span><span class="w">          </span><span class="err">│</span><span class="w">  </span><span class="mi">603980044827</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">STATES</span><span class="w"> </span><span class="err">│</span><span class="w">  </span><span class="mi">605069471323</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└──────┴───────────────┴───────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">35</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">.</span><span class="mi">066</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">600</span><span class="p">.</span><span class="mi">04</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">.</span><span class="mi">41</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">118</span><span class="p">.</span><span class="mi">43</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="mi">66</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">  
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：600,040,000</strong> <em>大约6亿</em></p>
<p><strong>耗时(秒)：5.066</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：35</strong></p>
<h4 id="query-42">Query 4.2</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">toYear</span><span class="p">(</span><span class="n">LO_ORDERDATE</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_CATEGORY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">sum</span><span class="p">(</span><span class="n">LO_REVENUE</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">LO_SUPPLYCOST</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">profit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">lineorder_flat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">C_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="n">S_REGION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;AMERICA&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="k">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1997</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="k">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1998</span><span class="p">))</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">((</span><span class="n">P_MFGR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MFGR#1&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="n">P_MFGR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MFGR#2&#39;</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_NATION</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_CATEGORY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">year</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">S_NATION</span><span class="w"> </span><span class="k">ASC</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">P_CATEGORY</span><span class="w"> </span><span class="k">ASC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">┌─</span><span class="k">year</span><span class="err">─┬─</span><span class="n">S_NATION</span><span class="err">──────┬─</span><span class="n">P_CATEGORY</span><span class="err">─┬───────</span><span class="n">profit</span><span class="err">─┐</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">ARGENTINA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">11</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">102369950215</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1997</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">ARGENTINA</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">12</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="mi">103052774082</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="p">....</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="p">.........</span><span class="w">     </span><span class="err">│</span><span class="w"> </span><span class="p">.......</span><span class="w">    </span><span class="err">│</span><span class="w"> </span><span class="p">............</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">STATES</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">24</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">60779388345</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">│</span><span class="w"> </span><span class="mi">1998</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">UNITED</span><span class="w"> </span><span class="n">STATES</span><span class="w"> </span><span class="err">│</span><span class="w"> </span><span class="n">MFGR</span><span class="o">#</span><span class="mi">25</span><span class="w">    </span><span class="err">│</span><span class="w">  </span><span class="mi">60042710566</span><span class="w"> </span><span class="err">│</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">└──────┴───────────────┴────────────┴──────────────┘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">100</span><span class="w"> </span><span class="k">rows</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">set</span><span class="p">.</span><span class="w"> </span><span class="n">Elapsed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">826</span><span class="w"> </span><span class="n">sec</span><span class="p">.</span><span class="w"> </span><span class="n">Processed</span><span class="w"> </span><span class="mi">144</span><span class="p">.</span><span class="mi">42</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">17</span><span class="w"> </span><span class="n">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">174</span><span class="p">.</span><span class="mi">78</span><span class="w"> </span><span class="n">million</span><span class="w"> </span><span class="k">rows</span><span class="o">/</span><span class="n">s</span><span class="p">.,</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="mi">63</span><span class="w"> </span><span class="n">GB</span><span class="o">/</span><span class="n">s</span><span class="p">.)</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>扫描行数：144,420,000</strong> <em>大约1亿4千多万</em></p>
<p><strong>耗时(秒)：0.826</strong></p>
<p><strong>查询列数：4</strong></p>
<p><strong>结果行数：100</strong></p>
<h2 id="性能测试结果汇总">性能测试结果汇总</h2>
<table>
<thead>
<tr>
<th style="text-align:left">查询语句</th>
<th style="text-align:left">SQL简要说明</th>
<th style="text-align:right">扫描行数</th>
<th style="text-align:right">返回行数</th>
<th style="text-align:right">查询列数</th>
<th style="text-align:right">耗时(秒)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Q1.1</td>
<td style="text-align:left">乘积、汇总、4个条件、首次运行</td>
<td style="text-align:right">91,010,000</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0.242</td>
</tr>
<tr>
<td style="text-align:left">Q1.2</td>
<td style="text-align:left">Q1.1增加1个条件运行</td>
<td style="text-align:right">7,750,000</td>
<td style="text-align:right">1</td>
<td style="text-align:right">2</td>
<td style="text-align:right">0.040</td>
</tr>
<tr>
<td style="text-align:left">Q2.1</td>
<td style="text-align:left">汇总、函数、2列分组、2列排序、首次运行</td>
<td style="text-align:right">600,040,000</td>
<td style="text-align:right">280</td>
<td style="text-align:right">3</td>
<td style="text-align:right">8.558</td>
</tr>
<tr>
<td style="text-align:left">Q2.2</td>
<td style="text-align:left">Q2.1增加1个条件运行</td>
<td style="text-align:right">600,040,000</td>
<td style="text-align:right">56</td>
<td style="text-align:right">3</td>
<td style="text-align:right">1.242</td>
</tr>
<tr>
<td style="text-align:left">Q3.1</td>
<td style="text-align:left">汇总、函数、3列分组、2列排序、首次运行</td>
<td style="text-align:right">546,670,000</td>
<td style="text-align:right">150</td>
<td style="text-align:right">4</td>
<td style="text-align:right">3.533</td>
</tr>
<tr>
<td style="text-align:left">Q3.2</td>
<td style="text-align:left">Q3.1更换条件运行</td>
<td style="text-align:right">546,670,000</td>
<td style="text-align:right">600</td>
<td style="text-align:right">4</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:left">Q4.1</td>
<td style="text-align:left">相减、汇总、函数、2列分组、2列排序、首次运行</td>
<td style="text-align:right">600,040,000</td>
<td style="text-align:right">35</td>
<td style="text-align:right">4</td>
<td style="text-align:right">5.006</td>
</tr>
<tr>
<td style="text-align:left">Q4.2</td>
<td style="text-align:left">Q4.1增加2个条件运行</td>
<td style="text-align:right">144,420,000</td>
<td style="text-align:right">100</td>
<td style="text-align:right">4</td>
<td style="text-align:right">0.826</td>
</tr>
</tbody>
</table>
<p>在当前软硬件环境下，扫描 6 亿多行数据，常见的分析语句首次运行最慢在 8 秒左右能返回结果，相同的分析逻辑更换条件再次查询的时候效率有明显的提升，可以缩短到 1 秒左右，如果只是简单的列查询没有加减乘除、聚合等逻辑，扫描全表 6 亿多行数据首次查询基本可以在 2 秒内执行完成。</p>
<p>以上是单机部署 Clickhouse 的性能表现情况，在不提升单机硬件性能的条件下，如果使用合理的集群部署，性能还能进一步提高。</p>
<p>这个表现，毋庸置疑是目前离线数据分析数据库领域的性能王者。</p>
]]></description></item></channel></rss>